# FPS 게임 프로젝트 아키텍처 명세서 (Vibe Jam 2025)

## 1. 프로젝트 개요

본 프로젝트는 "Vibe Jam 2025" 대회를 위한 웹 기반 FPS(First Person Shooter) 게임으로, ThreeJS와 CannonJS를 활용한 3D 환경에서 총으로 타겟을 맞추는 게임입니다. 주요 요구사항은 다음과 같습니다:

- 코드의 80% 이상이 AI에 의해 작성되어야 함
- 웹 브라우저에서 로딩 화면 없이 즉시 플레이 가능해야 함
- 사용자 로그인이나 가입 없이 무료로 플레이 가능해야 함
- ThreeJS를 활용한 3D 그래픽 구현
- 모바일 및 데스크톱 환경 모두 지원

## 2. 시스템 아키텍처

### 2.1 전체 시스템 구성

프로젝트는 모듈식 아키텍처를 채택하여 다음과 같은 주요 시스템으로 구성됩니다:

```
+--------------------------------+
|            Game Core           |
|        (Game.js, main)         |
+--------------------------------+
         |         |        |
 +---------------+ | +----------------+
 |    Rendering  | | |  Physics &     |
 |   (Graphics)  | | |  Environment   |
 +---------------+ | +----------------+
         |         |        |
+----------------+ | +----------------+
|    Gameplay    | | |    Input &     |
|   (Targets)    | | |   Controls     |
+----------------+ | +----------------+
         |         |        |
 +---------------+ | +----------------+
 |   Feedback    | | |   Settings &   |
 | (Audio, FX)   | | |  Localization  |
 +---------------+ | +----------------+
```

### 2.2 버전 관리 시스템

프로젝트는 여러 버전(v0.0.1부터 v0.1.1까지)으로 구성되며, 루트 `index.html` 파일이 버전 선택 인터페이스를 제공합니다:

- 각 버전은 독립적인 폴더 구조를 가짐
- iframe을 통해 선택된 버전의 게임이 로드됨
- 버전 간 통신은 window.postMessage API를 사용
- 게임 상태(menu, playing, gameOver)에 따라 버전 선택기 UI 표시/숨김 처리

## 3. 핵심 모듈 구성

### 3.1 핵심 게임 엔진 (Game.js)

```
+------------------+
|      Game.js     |
+------------------+
| - 게임 상태 관리  |
| - 게임 루프      |
| - 물리 엔진 통합  |
| - 점수/탄약/시간  |
| - 발사 메커니즘   |
| - 설정 화면 제어  |
+------------------+
```

- **주요 기능**:
  - 게임 초기화 및 애니메이션 루프 관리
  - 플레이어 상태(점수, 탄약, 시간, 체력) 관리
  - 타이머 및 게임 종료 조건 처리
  - 다른 모듈과의 통합 및 조정
  - 부모 창과의 통신(iframe 사용 시)

### 3.2 렌더링 시스템 (Graphics.js)

```
+------------------+
|    Graphics.js   |
+------------------+
| - ThreeJS 초기화  |
| - 씬 렌더링      |
| - 카메라 제어     |
| - 광원 설정      |
| - 특수 효과      |
+------------------+
```

- **주요 기능**:
  - ThreeJS 씬, 카메라, 렌더러 초기화 및 관리
  - 조명 및 그림자 설정
  - 시각적 피드백(총구 화염, 히트 마커, 점수 텍스트)
  - 화면 크기 변경 대응(반응형)
  - 특수 효과(타겟 타격 시 스크린 효과)

### 3.3 물리 시스템 (Physics.js)

```
+------------------+
|    Physics.js    |
+------------------+
| - CannonJS 초기화 |
| - 물리 법칙 적용  |
| - 충돌 감지      |
| - 중력 계산      |
+------------------+
```

- **주요 기능**:
  - CannonJS 물리 세계 초기화
  - 플레이어 물리 몸체 생성 및 제어
  - 중력 및 충돌 시뮬레이션
  - 물리 단계(step) 업데이트

### 3.4 환경 시스템 (Environment.js)

```
+------------------+
|  Environment.js  |
+------------------+
| - 맵 구성 요소    |
| - 바닥, 벽 생성   |
| - 장애물 배치     |
| - 물리 충돌체 연결 |
+------------------+
```

- **주요 기능**:
  - 게임 환경 요소 생성(바닥, 벽, 장애물)
  - 3D 메시와 물리 충돌체 연결
  - 장애물 랜덤 배치
  - 맵 경계 설정

### 3.5 타겟 관리 시스템 (TargetManager.js)

```
+------------------+
| TargetManager.js |
+------------------+
| - 타겟 생성/관리  |
| - 타입별 타겟     |
| - 콤보 시스템     |
| - 점수 계산       |
| - 히트 감지       |
+------------------+
```

- **주요 기능**:
  - 여러 타입의 타겟 생성 및 관리(표준, 보너스, 페널티)
  - 타겟 움직임 패턴 및 리스폰 로직
  - 레이캐스팅을 통한 히트 감지
  - 콤보 시스템 및 배율 계산
  - 관통 샷 처리 및 특수 효과

### 3.6 입력 시스템 (InputManager.js)

```
+------------------+
|  InputManager.js |
+------------------+
| - 키보드 입력 처리 |
| - 마우스 입력 처리 |
| - 터치 입력 처리   |
| - 플랫폼 감지      |
| - 포인터 락 관리   |
+------------------+
```

- **주요 기능**:
  - 키보드, 마우스, 터치 입력 처리
  - 모바일/데스크톱 환경 감지 및 대응
  - 카메라 회전(시점 변경) 처리
  - 포인터 락 상태 관리
  - 조이스틱 및 모바일 컨트롤 구현

### 3.7 오디오 시스템 (AudioManager.js)

```
+------------------+
|  AudioManager.js |
+------------------+
| - 효과음 로드/재생 |
| - 배경음악 관리    |
| - 볼륨 조절       |
| - 사운드 캐싱     |
+------------------+
```

- **주요 기능**:
  - 게임 효과음 로드 및 재생
  - 배경음악 관리
  - 볼륨 설정 적용
  - 데이터 URI를 통한 내장 오디오 사용

### 3.8 게임 설정 시스템 (GameSettings.js)

```
+------------------+
| GameSettings.js  |
+------------------+
| - 키 바인딩 설정  |
| - 볼륨 설정      |
| - 설정 저장/로드  |
+------------------+
```

- **주요 기능**:
  - 게임 컨트롤 키 매핑 설정
  - 오디오 볼륨 설정
  - 설정 저장 및 로드
  - 설정 UI와의 연동

### 3.9 파티클 시스템 (ParticleSystem.js)

```
+------------------+
| ParticleSystem.js|
+------------------+
| - 파티클 생성     |
| - 파티클 애니메이션|
| - 타겟별 효과     |
| - 리소스 관리     |
+------------------+
```

- **주요 기능**:
  - 타겟 파괴 시 파티클 효과 생성
  - 파티클 애니메이션 및 수명 관리
  - 타겟 유형별 차별화된 효과
  - 파티클 리소스 최적화 및 정리

### 3.10 다국어 지원 시스템 (Localization.js)

```
+------------------+
| Localization.js  |
+------------------+
| - 언어 감지/설정  |
| - 텍스트 리소스   |
| - UI 업데이트     |
| - 설정 저장      |
+------------------+
```

- **주요 기능**:
  - 브라우저 언어 감지
  - 다국어 리소스 관리(한국어, 영어)
  - UI 텍스트 동적 업데이트
  - 언어 설정 저장

### 3.11 특수 기능 모듈 (GitHubTarget.js)

```
+------------------+
| GitHubTarget.js  |
+------------------+
| - 특수 타겟 생성  |
| - 히트 감지      |
| - 특수 효과      |
| - 링크 표시      |
+------------------+
```

- **주요 기능**:
  - GitHub 로고 모양의 특수 타겟 생성
  - 히트 감지 및 처리
  - 파티클 및 UI 효과
  - GitHub 저장소 링크 표시 팝업

## 4. 데이터 흐름 및 상호작용

### 4.1 모듈 간 통신

```
Game.js -----> InputManager.js
  |               |
  v               v
Graphics.js <--> Physics.js
  |               |
  v               v
TargetManager.js  Environment.js
  |               |
  v               v
AudioManager.js   ParticleSystem.js
```

- Game.js가 중앙 조정자 역할을 수행
- 각 모듈은 독립적으로 기능하면서 Game.js를 통해 통신
- 직접적인 모듈 간 참조는 최소화(느슨한 결합)

### 4.2 이벤트 흐름

1. **사용자 입력 처리**:
   ```
   사용자 입력 → InputManager → Game → Physics → Graphics
   ```

2. **발사 및 타겟 히트**:
   ```
   클릭 → InputManager → Game → 레이캐스트 → TargetManager 
   → 파티클/점수/사운드 → Graphics/AudioManager/ParticleSystem
   ```

3. **게임 상태 변경**:
   ```
   상태 변경 → Game → UI 업데이트 → 부모 iframe 통신
   ```

## 5. 주요 기능 구현

### 5.1 타겟 시스템

- **표준 타겟**: 빨간색, 10점, 느린 움직임
- **보너스 타겟**: 금색, 25점, 빠른 움직임, 특수 효과
- **페널티 타겟**: 녹색, -15점, 중간 속도, 콤보 리셋

### 5.2 콤보 시스템

- **콤보 카운트**: 연속 타격 시 증가, 페널티 타겟 또는 시간 초과 시 리셋
- **배율 시스템**: 3타 이상(1.5배), 5타 이상(2.0배), 10타 이상(3.0배)
- **시각적 피드백**: 화면 중앙에 콤보 카운터 표시

### 5.3 관통 샷

- **다중 타겟 히트**: 한 발로 여러 타겟 타격 가능
- **보너스 계산**: 기본 20점 + (타겟 수-1) * 15점
- **시각적 효과**: 관통 경로 표시, 스크린 플래시

### 5.4 시각적 피드백

- **타겟 파괴 효과**: 타입별 다른 파티클 효과
- **점수 표시**: 타겟 위치에 점수 애니메이션
- **히트 마커**: 화면 중앙에 히트 표시
- **총구 화염**: 발사 시 시각적 효과

### 5.5 모바일 지원

- **터치 컨트롤**: 가상 조이스틱과 발사 버튼
- **시점 변경**: 화면 오른쪽 터치로 시점 조정
- **UI 최적화**: 모바일 화면에 맞는 UI 배치

### 5.6 다국어 지원

- **지원 언어**: 한국어(ko), 영어(en)
- **자동 감지**: 브라우저 언어 기반 초기 설정
- **설정 저장**: 선택된 언어 로컬 스토리지에 저장

### 5.7 즉시 플레이

- **리소스 최적화**: 데이터 URI 활용, 경량 에셋
- **지연 로딩**: 필수 자원 먼저 로드 후 게임 시작
- **인라인 스크립트**: 초기 UI 빠르게 표시

## 6. 기술 스택

- **3D 렌더링**: Three.js
- **물리 엔진**: Cannon.js
- **프론트엔드**: HTML5, CSS3, JavaScript (ES6+)
- **오디오**: Web Audio API (data URI 인코딩)
- **저장소**: localStorage (설정 저장)
- **통신**: postMessage API (iframe 간 통신)

## 7. 개발 로드맵 및 버전 이력

| 버전 | 주요 기능 |
|------|----------|
| v0.0.1 | 초기 프로젝트 설정 및 기본 구조 |
| v0.0.2 | 총구 화염 표현, 이동 키 설정 기능 |
| v0.0.3 | 리팩터링(코드 파일 분할) |
| v0.0.4 | 전·후진 오류 수정과 카메라 시점 조작 오류 해결 |
| v0.0.5 | 모바일 시점 조작과 기본 스크롤 충돌 해결 |
| v0.0.6 | 다양한 타겟 시스템, 콤보 기능, 향상된 피드백 |
| v0.0.7 | 로딩 화면 금지 규칙에 맞춰 게임 시작 버튼 제거 |
| v0.0.8 | 타겟 파편 파티클 효과 추가 |
| v0.0.9 | GitHub 비밀 타겟 추가 |
| v0.1.0 | 다국어(한/영) 지원, 모바일 UX 개선, 설정 메뉴 통합 |
| v0.1.1 | 최종 버전: 최적화, 크로스 브라우저 호환성 개선 |

## 8. 향후 개발 방향

1. **성능 최적화**: 모바일 기기에서의 렌더링 및 물리 연산 최적화
2. **다중 난이도**: 쉬움, 보통, 어려움 난이도 옵션 추가
3. **멀티플레이어**: 실시간 또는 비동기식 멀티플레이어 모드
4. **추가 무기**: 다양한 무기 유형 및 게임플레이 추가
5. **레벨 시스템**: 프로그레션 및 보상 시스템 구현
6. **AI 적**: 움직이는 AI 적 추가
7. **모드 확장**: 시간 제한, 생존, 도전 등 다양한 게임 모드

## 9. 결론

이 FPS 게임 프로젝트는 모듈식 아키텍처를 통해 확장성과 유지보수성을 확보했으며, 즉시 시작, 모바일 지원, 다국어 지원 등 대회 요구사항을 충족하도록 설계되었습니다. 각 모듈은 독립적으로 기능하면서도 중앙 Game.js 모듈을 통해 유기적으로 상호작용합니다. 향후 개발은 성능 최적화, 게임플레이 다양화, 멀티플레이어 지원 등에 중점을 둘 수 있을 것입니다.
